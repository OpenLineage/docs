"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2408],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(n),h=r,d=u["".concat(p,".").concat(h)]||u[h]||m[h]||i;return n?o.createElement(d,a(a({ref:t},c),{},{components:n})):o.createElement(d,a({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var s=2;s<i;s++)a[s]=n[s];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},43731:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var o=n(87462),r=(n(67294),n(3905));const i={title:"The OpenLineage Airflow Provider is Here",date:new Date("2023-08-23T00:00:00.000Z"),authors:["Robinson","Obuchowski","Le Dem"],banner:"./banner.svg",description:"Built-in OpenLineage support in Airflow means big improvements in reliability, lineage output, and custom operator implementation."},a=void 0,l={permalink:"/blog/airflow-provider",source:"@site/blog/airflow-provider/index.mdx",title:"The OpenLineage Airflow Provider is Here",description:"Built-in OpenLineage support in Airflow means big improvements in reliability, lineage output, and custom operator implementation.",date:"2023-08-23T00:00:00.000Z",formattedDate:"August 23, 2023",tags:[],readingTime:4.365,hasTruncateMarker:!0,authors:[{name:"Michael Robinson",title:"OpenLineage Community Manager",url:"https://github.com/merobi-hub",imageURL:"https://github.com/merobi-hub.png",key:"Robinson"},{name:"Maciej Obuchowski",title:"OpenLineage Committer",url:"https://github.com/mobuchowski",imageURL:"https://github.com/mobuchowski.png",key:"Obuchowski"},{name:"Julien Le Dem",title:"OpenLineage Project Lead",url:"https://www.github.com/julienledem/",imageURL:"https://avatars.githubusercontent.com/u/367841?v=4",key:"Le Dem"}],frontMatter:{title:"The OpenLineage Airflow Provider is Here",date:"2023-08-23T00:00:00.000Z",authors:["Robinson","Obuchowski","Le Dem"],banner:"./banner.svg",description:"Built-in OpenLineage support in Airflow means big improvements in reliability, lineage output, and custom operator implementation."},prevItem:{title:"Metaphor's Integration with OpenLineage Enhances Data Governance and Collaboration",permalink:"/blog/metaphor-integration"},nextItem:{title:"Meet Us in Toronto on September 18th!",permalink:"/blog/airflow-summit-meetup"}},p={authorsImageUrls:[void 0,void 0,void 0]},s=[{value:"Critical Improvements",id:"critical-improvements",level:3},{value:"High-level Design",id:"high-level-design",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Example Operator",id:"example-operator",level:4},{value:"Implementing the Provider in Custom Operators",id:"implementing-the-provider-in-custom-operators",level:4},{value:"Future Development",id:"future-development",level:3},{value:"Supported Operators",id:"supported-operators",level:3},{value:"Additional Resources",id:"additional-resources",level:3}],c={toc:s};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This one is big. With the release of Airflow 2.7.0, the Airflow integration is now officially an Airflow Provider. This means the ",(0,r.kt)("inlineCode",{parentName:"p"},"openlineage-airflow")," package is now ",(0,r.kt)("inlineCode",{parentName:"p"},"apache-airflow-providers-openlineage")," in Airflow itself \u2013 a built-in feature of Airflow rather than an externally managed integration. Why does it matter where the integration \u201clives\u201d? The short answer: as an Airflow Provider, the integration will offer ",(0,r.kt)("em",{parentName:"p"},"improved reliability, broader support for operators, enhanced lineage, and easier implementation in custom operators")," going forward. "),(0,r.kt)("p",null,"Although still a work in progress in some key respects, the OpenLineage Provider promises to pay dividends to users and contributors alike while accelerating the growth of the OpenLineage Ecosystem."),(0,r.kt)("h3",{id:"critical-improvements"},"Critical Improvements"),(0,r.kt)("p",null,"Before 2.7.0, OpenLineage metadata was only available via a plugin implementation maintained in the OpenLineage project. In other words, the integration was an external package getting lineage from the outside. Being external to Airflow, the integration had to use extractors to get lineage \u2013 special classes created for all supported operators. In order to function, these locally maintained extractors had to understand operators\u2019 internals and know where to look for data. While being the best possible approach under the circumstances, this solution was hardly ideal. On the one hand, it was brittle because it depended on both operators\u2019 and Airflow\u2019s internals. On the other, it required extra work to maintain compatibility with new versions of providers and Airflow itself. We had to keep up with changes to not only operators ",(0,r.kt)("em",{parentName:"p"},"but also Airflow")," \u2013 which is not exactly a small, slowly-moving project."),(0,r.kt)("p",null,"Improvements coming with the provider are not limited to fixes, however. The OpenLineage Provider promises to enable some long-sought-after enhancements, including support for one of the most-used Airflow operators \u2013 more about which below. "),(0,r.kt)("h3",{id:"high-level-design"},"High-level Design"),(0,r.kt)("p",null,"The provider approach solves these maintenance and reliability issues by moving the extraction logic, along with unit tests, to each provider. Although a lot of up-front work has gone into creating the provider, full implementation of this solution has actually been distributed (and necessarily remains a work in progress). No longer self-contained, the integration is now part of the operator contract and belongs to every provider that supports OpenLineage. Relocating the extraction logic in this way makes the integration more robust by ensuring the stability of the lineage contract in each operator. Another benefit of the approach: adding lineage coverage to custom operators is now easier.    "),(0,r.kt)("h3",{id:"implementation"},"Implementation"),(0,r.kt)("p",null,"The OpenLineage Provider has been implemented in Airflow by reimplementing the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpenLineage/OpenLineage/tree/main/integration/airflow"},(0,r.kt)("inlineCode",{parentName:"a"},"openlineage-airflow"))," package from the OpenLineage project in the ",(0,r.kt)("inlineCode",{parentName:"p"},"apache-airflow-providers-openlineage")," provider in the base Airflow Docker image, where it can be easily enabled by configuration. Furthermore, lineage extraction logic that was included in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpenLineage/OpenLineage/tree/main/integration/airflow/openlineage/airflow/extractors"},"Extractors")," in that package is now implemented in operators living in their provider package along with unit tests, eliminating the need for Extractors in most cases. For this purpose, a new optional API for Operators (",(0,r.kt)("inlineCode",{parentName:"p"},"get_openlineage_facets_on_{start(), complete(ti), failure(ti)}"),", documented ",(0,r.kt)("a",{parentName:"p",href:"https://openlineage.io/docs/integrations/airflow/default-extractors"},"here"),") can be used."),(0,r.kt)("h4",{id:"example-operator"},"Example Operator"),(0,r.kt)("p",null,"The Google Cloud Provider in Airflow is one of the providers to which extraction logic has been added. The ",(0,r.kt)("inlineCode",{parentName:"p"},"get_openlineage_facets_on_complete()")," function in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/airflow/blob/main/airflow/providers/google/cloud/transfers/gcs_to_gcs.py#L556"},(0,r.kt)("inlineCode",{parentName:"a"},"gcs_to_gcs"))," operator shows how easy adding OpenLineage support to an operator can be."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'    def get_openlineage_facets_on_complete(self, task_instance):\n        """\n        Implementing _on_complete because the execute method does preprocessing on internals.\n\n        This means we won\'t have to normalize self.source_object and self.source_objects,\n        destination bucket and so on.\n        """\n        from openlineage.client.run import Dataset\n\n        from airflow.providers.openlineage.extractors import OperatorLineage\n\n        return OperatorLineage(\n            inputs=[\n                Dataset(namespace=f"gs://{self.source_bucket}", name=source)\n                for source in sorted(self.resolved_source_objects)\n            ],\n            outputs=[\n                Dataset(namespace=f"gs://{self.destination_bucket}", name=target)\n                for target in sorted(self.resolved_target_objects)\n            ],\n        )\n')),(0,r.kt)("p",null,"In this case, the operator itself presents us with the source and target buckets, and objects which will be copied. Implementing OpenLineage support requires only properly initializing the name and namespace of the object according to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpenLineage/docs/blob/main/docs/spec/naming.md"},"naming schema")," "),(0,r.kt)("h4",{id:"implementing-the-provider-in-custom-operators"},"Implementing the Provider in Custom Operators"),(0,r.kt)("p",null,"The OpenLineage Provider in Airflow makes implementing support for custom operators easy. In fact, now there is nothing stopping you from adding OpenLineage support to your own custom operator. The provider detects OpenLineage methods and calls them when appropriate \u2013 before task execution, after success, or after complete. Also, you don\u2019t have to add all three \u2013 the failure method falls back to the complete method if it\u2019s not present, and the complete method to the start method. "),(0,r.kt)("h3",{id:"future-development"},"Future Development"),(0,r.kt)("p",null,"The OpenLineage Provider makes possible several sought-after enhancements, including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Integration with XCom datasets (Airflow AIP-48)"),(0,r.kt)("li",{parentName:"ul"},"Coverage of ",(0,r.kt)("inlineCode",{parentName:"li"},"PythonOperator"),", the most-used operator in Airflow, including Task Flow support"),(0,r.kt)("li",{parentName:"ul"},"Support for Hooks, which would track their own lineage to be collected by the ",(0,r.kt)("inlineCode",{parentName:"li"},"PythonOperator")," and presented as its own lineage")),(0,r.kt)("h3",{id:"supported-operators"},"Supported Operators"),(0,r.kt)("p",null,"The OpenLineage Provider currently supports the following operators, with support for additional operators coming soon:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Apache Kafka"),(0,r.kt)("li",{parentName:"ul"},"AWS SageMaker"),(0,r.kt)("li",{parentName:"ul"},"GCS"),(0,r.kt)("li",{parentName:"ul"},"Common-SQL, including support for multiple databases like Postgres and MySQL"),(0,r.kt)("li",{parentName:"ul"},"MS Azure"),(0,r.kt)("li",{parentName:"ul"},"Snowflake")),(0,r.kt)("p",null,"We welcome contributions and feedback on operator support and will be happy to help anyone get started adding extraction logic to an existing or custom operator."),(0,r.kt)("h3",{id:"additional-resources"},"Additional Resources"),(0,r.kt)("p",null,"If you are interested in participating in the effort to add support for more operators, reach out to us on ",(0,r.kt)("a",{parentName:"p",href:"https://bit.ly/lineageslack"},"Slack"),"."),(0,r.kt)("p",null,"For background on the architecture and implementation plan, read the ",(0,r.kt)("a",{parentName:"p",href:"https://cwiki.apache.org/confluence/display/AIRFLOW/AIP-53+OpenLineage+in+Airflow"},"proposal"),"."),(0,r.kt)("p",null,"For guides on getting started with OpenLineage, read the ",(0,r.kt)("a",{parentName:"p",href:"https://openlineage.io/docs/"},"docs"),"."))}m.isMDXComponent=!0}}]);