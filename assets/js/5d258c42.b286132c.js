"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8214],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=i,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return t?a.createElement(g,r(r({ref:n},p),{},{components:t})):a.createElement(g,r({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var u=2;u<o;u++)r[u]=t[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},61235:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=t(87462),i=(t(67294),t(3905));const o={sidebar_position:2,title:"Usage Example"},r=void 0,l={unversionedId:"client/java/usage",id:"client/java/usage",title:"Usage Example",description:"1. Simple OpenLineage Client Test for Console Transport",source:"@site/docs/client/java/usage.md",sourceDirName:"client/java",slug:"/client/java/usage",permalink:"/docs/client/java/usage",draft:!1,editUrl:"https://github.com/OpenLineage/docs/tree/main/docs/client/java/usage.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Usage Example"},sidebar:"tutorialSidebar",previous:{title:"Configuration",permalink:"/docs/client/java/configuration"},next:{title:"Python",permalink:"/docs/client/python"}},s={},u=[{value:"1. Simple OpenLineage Client Test for Console Transport",id:"1-simple-openlineage-client-test-for-console-transport",level:3},{value:"2. Simple OpenLineage Client Test for Http Transport",id:"2-simple-openlineage-client-test-for-http-transport",level:3}],p={toc:u};function c(e){let{components:n,...o}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,o,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"// Use openlineage.yml\nOpenLineageClient client = Clients.newClient();\n\n// Define a simple OpenLineage START or COMPLETE event\nOpenLineage.RunEvent startOrCompleteRun = ...\n\n// Emit OpenLineage event\nclient.emit(startOrCompleteRun);\n")),(0,i.kt)("h3",{id:"1-simple-openlineage-client-test-for-console-transport"},"1. Simple OpenLineage Client Test for Console Transport"),(0,i.kt)("p",null,"First, let's explore how we can create OpenLineage client instance, but not using any actual transport to emit the data yet, except only to our ",(0,i.kt)("inlineCode",{parentName:"p"},"Console.")," This would be a good exercise to run tests and check the data payloads."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"    OpenLineageClient client = OpenLineageClient.builder()\n        .transport(new ConsoleTransport()).build();\n")),(0,i.kt)("p",null,"Also, we will then get a sample payload to produce a ",(0,i.kt)("inlineCode",{parentName:"p"},"RunEvent"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"    // create one start event for testing\n    RunEvent event = buildEvent(EventType.START);\n")),(0,i.kt)("p",null,"Lastly, we will emit this event using the client that we instantiated\\:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"    // emit the event\n    client.emit(event);\n")),(0,i.kt)("p",null,"Here is the full source code of the test client application:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package ol.test;\n\nimport io.openlineage.client.OpenLineage;\nimport io.openlineage.client.OpenLineageClient;\nimport io.openlineage.client.OpenLineage.RunEvent;\nimport io.openlineage.client.OpenLineage.InputDataset;\nimport io.openlineage.client.OpenLineage.Job;\nimport io.openlineage.client.OpenLineage.JobFacets;\nimport io.openlineage.client.OpenLineage.OutputDataset;\nimport io.openlineage.client.OpenLineage.Run;\nimport io.openlineage.client.OpenLineage.RunFacets;\nimport io.openlineage.client.OpenLineage.RunEvent.EventType;\nimport io.openlineage.client.transports.ConsoleTransport;\nimport io.openlineage.client.utils.UUIDUtils;\n\nimport java.net.URI;\nimport java.time.ZoneId;\nimport java.time.ZonedDateTime;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.UUID;\n\n/**\n * My first openlinage client code\n */\npublic class OpenLineageClientTest\n{\n    public static void main( String[] args )\n    {\n        try {\n            OpenLineageClient client = OpenLineageClient.builder()\n            .transport(new ConsoleTransport()).build();\n\n            // create one start event for testing\n            RunEvent event = buildEvent(EventType.START);\n\n            // emit the event\n            client.emit(event);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n    }\n\n    // sample code to build event\n    public static RunEvent buildEvent(EventType eventType) {\n        ZonedDateTime now = ZonedDateTime.now(ZoneId.of("UTC"));\n        URI producer = URI.create("producer");\n        OpenLineage ol = new OpenLineage(producer);\n        UUID runId = UUIDUtils.generateNewUUID();\n\n        // run facets\n        RunFacets runFacets =\n        ol.newRunFacetsBuilder()\n            .nominalTime(\n                ol.newNominalTimeRunFacetBuilder()\n                    .nominalStartTime(now)\n                    .nominalEndTime(now)\n                    .build())\n            .build();\n\n        // a run is composed of run id, and run facets\n        Run run = ol.newRunBuilder().runId(runId).facets(runFacets).build();\n\n        // job facets\n        JobFacets jobFacets = ol.newJobFacetsBuilder().build();\n\n        // job\n        String name = "jobName";\n        String namespace = "namespace";\n        Job job = ol.newJobBuilder().namespace(namespace).name(name).facets(jobFacets).build();\n\n        // input dataset\n        List<InputDataset> inputs =\n        Arrays.asList(\n            ol.newInputDatasetBuilder()\n                .namespace("ins")\n                .name("input")\n                .facets(\n                    ol.newDatasetFacetsBuilder()\n                        .version(ol.newDatasetVersionDatasetFacet("input-version"))\n                        .build())\n                .inputFacets(\n                    ol.newInputDatasetInputFacetsBuilder()\n                        .dataQualityMetrics(\n                            ol.newDataQualityMetricsInputDatasetFacetBuilder()\n                                .rowCount(10L)\n                                .bytes(20L)\n                                .columnMetrics(\n                                    ol.newDataQualityMetricsInputDatasetFacetColumnMetricsBuilder()\n                                        .put(\n                                            "mycol",\n                                            ol.newDataQualityMetricsInputDatasetFacetColumnMetricsAdditionalBuilder()\n                                                .count(10D)\n                                                .distinctCount(10L)\n                                                .max(30D)\n                                                .min(5D)\n                                                .nullCount(1L)\n                                                .sum(3000D)\n                                                .quantiles(\n                                                    ol.newDataQualityMetricsInputDatasetFacetColumnMetricsAdditionalQuantilesBuilder()\n                                                        .put("25", 52D)\n                                                        .build())\n                                                .build())\n                                        .build())\n                                .build())\n                        .build())\n                .build());\n        // output dataset\n        List<OutputDataset> outputs =\n            Arrays.asList(\n                ol.newOutputDatasetBuilder()\n                    .namespace("ons")\n                    .name("output")\n                    .facets(\n                        ol.newDatasetFacetsBuilder()\n                            .version(ol.newDatasetVersionDatasetFacet("output-version"))\n                            .build())\n                    .outputFacets(\n                        ol.newOutputDatasetOutputFacetsBuilder()\n                            .outputStatistics(ol.newOutputStatisticsOutputDatasetFacet(10L, 20L))\n                            .build())\n                    .build());\n\n        // run state udpate which encapsulates all - with START event in this case\n        RunEvent runStateUpdate =\n        ol.newRunEventBuilder()\n            .eventType(OpenLineage.RunEvent.EventType.START)\n            .eventTime(now)\n            .run(run)\n            .job(job)\n            .inputs(inputs)\n            .outputs(outputs)\n            .build();\n\n        return runStateUpdate;\n    }\n}\n')),(0,i.kt)("p",null,"The result of running this will result in the following output from your Java application:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[main] INFO io.openlineage.client.transports.ConsoleTransport - {"eventType":"START","eventTime":"2022-08-05T15:11:24.858414Z","run":{"runId":"bb46bbc4-fb1a-495a-ad3b-8d837f566749","facets":{"nominalTime":{"_producer":"producer","_schemaURL":"https://openlineage.io/spec/facets/1-0-0/NominalTimeRunFacet.json#/$defs/NominalTimeRunFacet","nominalStartTime":"2022-08-05T15:11:24.858414Z","nominalEndTime":"2022-08-05T15:11:24.858414Z"}}},"job":{"namespace":"namespace","name":"jobName","facets":{}},"inputs":[{"namespace":"ins","name":"input","facets":{"version":{"_producer":"producer","_schemaURL":"https://openlineage.io/spec/facets/1-0-0/DatasetVersionDatasetFacet.json#/$defs/DatasetVersionDatasetFacet","datasetVersion":"input-version"}},"inputFacets":{"dataQualityMetrics":{"_producer":"producer","_schemaURL":"https://openlineage.io/spec/facets/1-0-0/DataQualityMetricsInputDatasetFacet.json#/$defs/DataQualityMetricsInputDatasetFacet","rowCount":10,"bytes":20,"columnMetrics":{"mycol":{"nullCount":1,"distinctCount":10,"sum":3000.0,"count":10.0,"min":5.0,"max":30.0,"quantiles":{"25":52.0}}}}}}],"outputs":[{"namespace":"ons","name":"output","facets":{"version":{"_producer":"producer","_schemaURL":"https://openlineage.io/spec/facets/1-0-0/DatasetVersionDatasetFacet.json#/$defs/DatasetVersionDatasetFacet","datasetVersion":"output-version"}},"outputFacets":{"outputStatistics":{"_producer":"producer","_schemaURL":"https://openlineage.io/spec/facets/1-0-0/OutputStatisticsOutputDatasetFacet.json#/$defs/OutputStatisticsOutputDatasetFacet","rowCount":10,"size":20}}}],"producer":"producer","schemaURL":"https://openlineage.io/spec/1-0-2/OpenLineage.json#/$defs/RunEvent"}\n')),(0,i.kt)("h3",{id:"2-simple-openlineage-client-test-for-http-transport"},"2. Simple OpenLineage Client Test for Http Transport"),(0,i.kt)("p",null,"Now, using the same code base, we will change how the client application works by switching the Console transport into ",(0,i.kt)("inlineCode",{parentName:"p"},"Http Transport")," as shown below. This code will now be able to send the OpenLineage events into a compatible backends such as ",(0,i.kt)("a",{parentName:"p",href:"https://marquezproject.ai/"},"Marquez"),"."),(0,i.kt)("p",null,"Before making this change and running it, make sure you have an instance of Marquez running on your local environment. Setting up and running Marquez can be found ",(0,i.kt)("a",{parentName:"p",href:"https://marquezproject.github.io/marquez/quickstart.html"},"here"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'OpenLineageClient client = OpenLineageClient.builder()\n    .transport(\n        HttpTransport.builder()\n        .uri("http://localhost:5000")\n        .build())\n    .build();\n')),(0,i.kt)("p",null,"If we ran the same application, you will now see the event data not emitted in the output console, but rather via the HTTP transport to the marquez backend that was running."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"the Marquez graph",src:t(54842).Z,width:"1312",height:"433"})),(0,i.kt)("p",null,"Notice that the Status of this job run will be in ",(0,i.kt)("inlineCode",{parentName:"p"},"RUNNING")," state, as it will be in that state until it receives an ",(0,i.kt)("inlineCode",{parentName:"p"},"end")," event that will close off its gaps. That is how the OpenLineage events would work."),(0,i.kt)("p",null,"Now, let's change the previous example to have lineage event doing a complete cycle of ",(0,i.kt)("inlineCode",{parentName:"p"},"START")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"COMPLETE"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package ol.test;\n\nimport io.openlineage.client.OpenLineage;\nimport io.openlineage.client.OpenLineageClient;\nimport io.openlineage.client.OpenLineage.RunEvent;\nimport io.openlineage.client.OpenLineage.InputDataset;\nimport io.openlineage.client.OpenLineage.Job;\nimport io.openlineage.client.OpenLineage.JobFacets;\nimport io.openlineage.client.OpenLineage.OutputDataset;\nimport io.openlineage.client.OpenLineage.Run;\nimport io.openlineage.client.OpenLineage.RunFacets;\nimport io.openlineage.client.OpenLineage.RunEvent.EventType;\nimport io.openlineage.client.transports.HttpTransport;\nimport io.openlineage.client.utils.UUIDUtils;\n\nimport java.net.URI;\nimport java.time.ZoneId;\nimport java.time.ZonedDateTime;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.UUID;\n\n/**\n * My first openlinage client code\n */\npublic class OpenLineageClientTest\n{\n    public static void main( String[] args )\n    {\n        try {\n\n            OpenLineageClient client = OpenLineageClient.builder()\n                .transport(\n                    HttpTransport.builder()\n                    .uri("http://localhost:5000")\n                    .build())\n                .build();\n\n            // create one start event for testing\n            RunEvent event = buildEvent(EventType.START, null);\n\n            // emit the event\n            client.emit(event);\n\n            // another event to COMPLETE the run\n            event = buildEvent(EventType.COMPLETE, event.getRun().getRunId());\n\n            // emit the second COMPLETE event\n            client.emit(event);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    // sample code to build event\n    public static RunEvent buildEvent(EventType eventType, UUID runId) {\n        ZonedDateTime now = ZonedDateTime.now(ZoneId.of("UTC"));\n        URI producer = URI.create("producer");\n        OpenLineage ol = new OpenLineage(producer);\n\n        if (runId == null) {\n            runId = UUIDUtils.generateNewUUID();\n        }\n\n        // run facets\n        RunFacets runFacets =\n        ol.newRunFacetsBuilder()\n            .nominalTime(\n                ol.newNominalTimeRunFacetBuilder()\n                    .nominalStartTime(now)\n                    .nominalEndTime(now)\n                    .build())\n            .build();\n\n        // a run is composed of run id, and run facets\n        Run run = ol.newRunBuilder().runId(runId).facets(runFacets).build();\n\n        // job facets\n        JobFacets jobFacets = ol.newJobFacetsBuilder().build();\n\n        // job\n        String name = "jobName";\n        String namespace = "namespace";\n        Job job = ol.newJobBuilder().namespace(namespace).name(name).facets(jobFacets).build();\n\n        // input dataset\n        List<InputDataset> inputs =\n        Arrays.asList(\n            ol.newInputDatasetBuilder()\n                .namespace("ins")\n                .name("input")\n                .facets(\n                    ol.newDatasetFacetsBuilder()\n                        .version(ol.newDatasetVersionDatasetFacet("input-version"))\n                        .build())\n                .inputFacets(\n                    ol.newInputDatasetInputFacetsBuilder()\n                        .dataQualityMetrics(\n                            ol.newDataQualityMetricsInputDatasetFacetBuilder()\n                                .rowCount(10L)\n                                .bytes(20L)\n                                .columnMetrics(\n                                    ol.newDataQualityMetricsInputDatasetFacetColumnMetricsBuilder()\n                                        .put(\n                                            "mycol",\n                                            ol.newDataQualityMetricsInputDatasetFacetColumnMetricsAdditionalBuilder()\n                                                .count(10D)\n                                                .distinctCount(10L)\n                                                .max(30D)\n                                                .min(5D)\n                                                .nullCount(1L)\n                                                .sum(3000D)\n                                                .quantiles(\n                                                    ol.newDataQualityMetricsInputDatasetFacetColumnMetricsAdditionalQuantilesBuilder()\n                                                        .put("25", 52D)\n                                                        .build())\n                                                .build())\n                                        .build())\n                                .build())\n                        .build())\n                .build());\n        // output dataset\n        List<OutputDataset> outputs =\n            Arrays.asList(\n                ol.newOutputDatasetBuilder()\n                    .namespace("ons")\n                    .name("output")\n                    .facets(\n                        ol.newDatasetFacetsBuilder()\n                            .version(ol.newDatasetVersionDatasetFacet("output-version"))\n                            .build())\n                    .outputFacets(\n                        ol.newOutputDatasetOutputFacetsBuilder()\n                            .outputStatistics(ol.newOutputStatisticsOutputDatasetFacet(10L, 20L))\n                            .build())\n                    .build());\n\n        // run state udpate which encapsulates all - with START event in this case\n        RunEvent runStateUpdate =\n        ol.newRunEventBuilder()\n            .eventType(eventType)\n            .eventTime(now)\n            .run(run)\n            .job(job)\n            .inputs(inputs)\n            .outputs(outputs)\n            .build();\n\n        return runStateUpdate;\n    }\n}\n')),(0,i.kt)("p",null,"Now, when you run this application, the Marquez would have an output that would looke like this:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"the Marquez graph",src:t(92842).Z,width:"1590",height:"772"})))}c.isMDXComponent=!0},92842:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/mqz_job_complete-a6ab12c075e6c866a9e1499d6f0e6fda.png"},54842:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/mqz_job_running-4e81dcf60903a55a2c7a17ff2e761b26.png"}}]);