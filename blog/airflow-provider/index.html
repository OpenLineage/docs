<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">The OpenLineage Airflow Provider is Here | OpenLineage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openlineage.io/blog/airflow-provider"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="The OpenLineage Airflow Provider is Here | OpenLineage"><meta data-rh="true" name="description" content="Built-in OpenLineage support in Airflow means big improvements in reliability, lineage output, and custom operator implementation."><meta data-rh="true" property="og:description" content="Built-in OpenLineage support in Airflow means big improvements in reliability, lineage output, and custom operator implementation."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-23T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/merobi-hub,https://github.com/mobuchowski,https://www.github.com/julienledem/"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openlineage.io/blog/airflow-provider"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/airflow-provider" hreflang="en"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/airflow-provider" hreflang="x-default"><link rel="alternate" type="application/json" href="/blog/feed.json" title="OpenLineage JSON Feed">






<script src="https://plausible.io/js/script.js" defer="defer" data-domain="openlineage.io"></script>
<script src="js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-QMTWMLMX4M" async></script><link rel="stylesheet" href="/assets/css/styles.2f7146bc.css">
<link rel="preload" href="/assets/js/runtime~main.47319d3d.js" as="script">
<link rel="preload" href="/assets/js/main.c66bd586.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/resources">Resources</a><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/community">Community</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/survey">Ecosystem Survey 2023</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OpenLineage/openlineage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/boston-collibra-meetup">Join us in Boston on March 19th</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/kafka-summit-talk">OpenLineage Support for Streaming to Feature at Kafka Summit</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/london-confluent-meetup">Join us in London on January 31st</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/warsaw-meetup">Meet Us in Warsaw on November 29th!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/metaphor-integration">Metaphor&#x27;s Integration with OpenLineage Enhances Data Governance and Collaboration</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">The OpenLineage Airflow Provider is Here</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-23T00:00:00.000Z" itemprop="datePublished">August 23, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/merobi-hub" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/merobi-hub.png" alt="Michael Robinson"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/merobi-hub" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Robinson</span></a></div><small class="avatar__subtitle" itemprop="description">OpenLineage Community Manager</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mobuchowski" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mobuchowski.png" alt="Maciej Obuchowski"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mobuchowski" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Maciej Obuchowski</span></a></div><small class="avatar__subtitle" itemprop="description">OpenLineage Committer</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://www.github.com/julienledem/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/367841?v=4" alt="Julien Le Dem"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.github.com/julienledem/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Julien Le Dem</span></a></div><small class="avatar__subtitle" itemprop="description">OpenLineage Project Lead</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>This one is big. With the release of Airflow 2.7.0, the Airflow integration is now officially an Airflow Provider. This means the <code>openlineage-airflow</code> package is now <code>apache-airflow-providers-openlineage</code> in Airflow itself – a built-in feature of Airflow rather than an externally managed integration. Why does it matter where the integration “lives”? The short answer: as an Airflow Provider, the integration will offer <em>improved reliability, broader support for operators, enhanced lineage, and easier implementation in custom operators</em> going forward. </p><p>Although still a work in progress in some key respects, the OpenLineage Provider promises to pay dividends to users and contributors alike while accelerating the growth of the OpenLineage Ecosystem.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="critical-improvements">Critical Improvements<a href="#critical-improvements" class="hash-link" aria-label="Direct link to Critical Improvements" title="Direct link to Critical Improvements">​</a></h3><p>Before 2.7.0, OpenLineage metadata was only available via a plugin implementation maintained in the OpenLineage project. In other words, the integration was an external package getting lineage from the outside. Being external to Airflow, the integration had to use extractors to get lineage – special classes created for all supported operators. In order to function, these locally maintained extractors had to understand operators’ internals and know where to look for data. While being the best possible approach under the circumstances, this solution was hardly ideal. On the one hand, it was brittle because it depended on both operators’ and Airflow’s internals. On the other, it required extra work to maintain compatibility with new versions of providers and Airflow itself. We had to keep up with changes to not only operators <em>but also Airflow</em> – which is not exactly a small, slowly-moving project.</p><p>Improvements coming with the provider are not limited to fixes, however. The OpenLineage Provider promises to enable some long-sought-after enhancements, including support for one of the most-used Airflow operators – more about which below. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-design">High-level Design<a href="#high-level-design" class="hash-link" aria-label="Direct link to High-level Design" title="Direct link to High-level Design">​</a></h3><p>The provider approach solves these maintenance and reliability issues by moving the extraction logic, along with unit tests, to each provider. Although a lot of up-front work has gone into creating the provider, full implementation of this solution has actually been distributed (and necessarily remains a work in progress). No longer self-contained, the integration is now part of the operator contract and belongs to every provider that supports OpenLineage. Relocating the extraction logic in this way makes the integration more robust by ensuring the stability of the lineage contract in each operator. Another benefit of the approach: adding lineage coverage to custom operators is now easier.    </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h3><p>The OpenLineage Provider has been implemented in Airflow by reimplementing the <a href="https://github.com/OpenLineage/OpenLineage/tree/main/integration/airflow" target="_blank" rel="noopener noreferrer"><code>openlineage-airflow</code></a> package from the OpenLineage project in the <code>apache-airflow-providers-openlineage</code> provider in the base Airflow Docker image, where it can be easily enabled by configuration. Furthermore, lineage extraction logic that was included in <a href="https://github.com/OpenLineage/OpenLineage/tree/main/integration/airflow/openlineage/airflow/extractors" target="_blank" rel="noopener noreferrer">Extractors</a> in that package is now implemented in operators living in their provider package along with unit tests, eliminating the need for Extractors in most cases. For this purpose, a new optional API for Operators (<code>get_openlineage_facets_on_{start(), complete(ti), failure(ti)}</code>, documented <a href="https://openlineage.io/docs/integrations/airflow/default-extractors" target="_blank" rel="noopener noreferrer">here</a>) can be used.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-operator">Example Operator<a href="#example-operator" class="hash-link" aria-label="Direct link to Example Operator" title="Direct link to Example Operator">​</a></h4><p>The Google Cloud Provider in Airflow is one of the providers to which extraction logic has been added. The <code>get_openlineage_facets_on_complete()</code> function in the <a href="https://github.com/apache/airflow/blob/main/airflow/providers/google/cloud/transfers/gcs_to_gcs.py#L556" target="_blank" rel="noopener noreferrer"><code>gcs_to_gcs</code></a> operator shows how easy adding OpenLineage support to an operator can be.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def get_openlineage_facets_on_complete(self, task_instance):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Implementing _on_complete because the execute method does preprocessing on internals.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        This means we won&#x27;t have to normalize self.source_object and self.source_objects,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        destination bucket and so on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from openlineage.client.run import Dataset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from airflow.providers.openlineage.extractors import OperatorLineage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return OperatorLineage(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            inputs=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Dataset(namespace=f&quot;gs://{self.source_bucket}&quot;, name=source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for source in sorted(self.resolved_source_objects)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outputs=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Dataset(namespace=f&quot;gs://{self.destination_bucket}&quot;, name=target)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for target in sorted(self.resolved_target_objects)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, the operator itself presents us with the source and target buckets, and objects which will be copied. Implementing OpenLineage support requires only properly initializing the name and namespace of the object according to the <a href="https://github.com/OpenLineage/docs/blob/main/docs/spec/naming.md" target="_blank" rel="noopener noreferrer">naming schema</a> </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-the-provider-in-custom-operators">Implementing the Provider in Custom Operators<a href="#implementing-the-provider-in-custom-operators" class="hash-link" aria-label="Direct link to Implementing the Provider in Custom Operators" title="Direct link to Implementing the Provider in Custom Operators">​</a></h4><p>The OpenLineage Provider in Airflow makes implementing support for custom operators easy. In fact, now there is nothing stopping you from adding OpenLineage support to your own custom operator. The provider detects OpenLineage methods and calls them when appropriate – before task execution, after success, or after complete. Also, you don’t have to add all three – the failure method falls back to the complete method if it’s not present, and the complete method to the start method. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="future-development">Future Development<a href="#future-development" class="hash-link" aria-label="Direct link to Future Development" title="Direct link to Future Development">​</a></h3><p>The OpenLineage Provider makes possible several sought-after enhancements, including:</p><ul><li>Integration with XCom datasets (Airflow AIP-48)</li><li>Coverage of <code>PythonOperator</code>, the most-used operator in Airflow, including Task Flow support</li><li>Support for Hooks, which would track their own lineage to be collected by the <code>PythonOperator</code> and presented as its own lineage</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="supported-operators">Supported Operators<a href="#supported-operators" class="hash-link" aria-label="Direct link to Supported Operators" title="Direct link to Supported Operators">​</a></h3><p>The OpenLineage Provider currently supports the following operators, with support for additional operators coming soon:</p><ul><li>Apache Kafka</li><li>AWS SageMaker</li><li>GCS</li><li>Common-SQL, including support for multiple databases like Postgres and MySQL</li><li>MS Azure</li><li>Snowflake</li></ul><p>We welcome contributions and feedback on operator support and will be happy to help anyone get started adding extraction logic to an existing or custom operator.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h3><p>If you are interested in participating in the effort to add support for more operators, reach out to us on <a href="https://bit.ly/lineageslack" target="_blank" rel="noopener noreferrer">Slack</a>.</p><p>For background on the architecture and implementation plan, read the <a href="https://cwiki.apache.org/confluence/display/AIRFLOW/AIP-53+OpenLineage+in+Airflow" target="_blank" rel="noopener noreferrer">proposal</a>.</p><p>For guides on getting started with OpenLineage, read the <a href="https://openlineage.io/docs/" target="_blank" rel="noopener noreferrer">docs</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/metaphor-integration"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Metaphor&#x27;s Integration with OpenLineage Enhances Data Governance and Collaboration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/airflow-summit-meetup"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Meet Us in Toronto on September 18th!</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#critical-improvements" class="table-of-contents__link toc-highlight">Critical Improvements</a></li><li><a href="#high-level-design" class="table-of-contents__link toc-highlight">High-level Design</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#future-development" class="table-of-contents__link toc-highlight">Future Development</a></li><li><a href="#supported-operators" class="table-of-contents__link toc-highlight">Supported Operators</a></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional Resources</a></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.47319d3d.js"></script>
<script src="/assets/js/main.c66bd586.js"></script>
</body>
</html>