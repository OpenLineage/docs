<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">The Current State of Column-level Lineage | OpenLineage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openlineage.io/blog/column-lineage"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="The Current State of Column-level Lineage | OpenLineage"><meta data-rh="true" name="description" content="Column-level lineage helps organizations navigate a complex regulatory landscape."><meta data-rh="true" property="og:description" content="Column-level lineage helps organizations navigate a complex regulatory landscape."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-09-02T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/merobi-hub"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openlineage.io/blog/column-lineage"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/column-lineage" hreflang="en"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/column-lineage" hreflang="x-default"><link rel="alternate" type="application/json" href="/blog/feed.json" title="OpenLineage JSON Feed">






<script src="https://plausible.io/js/script.js" defer="defer" data-domain="openlineage.io"></script>
<script src="js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-QMTWMLMX4M" async></script><link rel="stylesheet" href="/assets/css/styles.e2913961.css">
<link rel="preload" href="/assets/js/runtime~main.c8354045.js" as="script">
<link rel="preload" href="/assets/js/main.bb3d165b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/resources">Resources</a><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/community">Community</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/survey">Ecosystem Survey 2023</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OpenLineage/openlineage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/boston-collibra-meetup">Join us in Boston on March 19th</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/kafka-summit-talk">OpenLineage Support for Streaming to Feature at Kafka Summit</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/london-confluent-meetup">Join us in London on January 31st</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/warsaw-meetup">Meet Us in Warsaw on November 29th!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/metaphor-integration">Metaphor&#x27;s Integration with OpenLineage Enhances Data Governance and Collaboration</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">The Current State of Column-level Lineage</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-09-02T00:00:00.000Z" itemprop="datePublished">September 2, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/merobi-hub" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/merobi-hub.png" alt="Michael Robinson"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/merobi-hub" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Robinson</span></a></div><small class="avatar__subtitle" itemprop="description">OpenLineage Community Manager</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Column-level lineage helps organizations navigate a complex regulatory landscape.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview--background">Overview &amp; background<a href="#overview--background" class="hash-link" aria-label="Direct link to Overview &amp; background" title="Direct link to Overview &amp; background">​</a></h3><p>Long one of our most requested new features, column-level lineage was added to the <a href="https://github.com/OpenLineage/OpenLineage/tree/main/integration/spark" target="_blank" rel="noopener noreferrer">Spark integration</a> with the release of <a href="https://github.com/OpenLineage/OpenLineage/releases/tag/0.9.0" target="_blank" rel="noopener noreferrer">OpenLineage 0.9.0</a>. Project committer Paweł Leszczyński (<a href="https://github.com/pawel-big-lebowski" target="_blank" rel="noopener noreferrer">@pawel-big-lebowski</a>) authored the relevant pull requests (<a href="https://github.com/OpenLineage/OpenLineage/pull/645" target="_blank" rel="noopener noreferrer">#645</a>, <a href="https://github.com/OpenLineage/OpenLineage/pull/698" target="_blank" rel="noopener noreferrer">#698</a>, <a href="https://github.com/OpenLineage/OpenLineage/pull/738" target="_blank" rel="noopener noreferrer">#738</a> and <a href="https://github.com/OpenLineage/OpenLineage/pull/772" target="_blank" rel="noopener noreferrer">#772</a>). In its current form, column-level lineage in OpenLineage is limited to the Spark integration and not yet visible in the <a href="https://marquezproject.ai/" target="_blank" rel="noopener noreferrer">Marquez</a> UI. But this is only the first step in a broader, ongoing project to implement the feature across the project, and we’d love your help. </p><p>Column-level lineage is a worthy pursuit. It dramatically extends the reach of OpenLineage’s metadata capture, providing finely grained information about datasets&#x27; dependencies. As Paweł and project lead Julien Le Dem (<a href="https://github.com/julienledem" target="_blank" rel="noopener noreferrer">@julienledem</a>) wrote in the initial proposal, “Not only can we know that a dependency exists, but we are also able to understand which input columns are used to produce output columns. This allows <!-- -->[for]<!-- --> answering questions like ‘Which root input columns are used to construct column x?’”</p><p>Another reason to pursue column-level lineage: the demands of regulatory compliance. Bodies such as the <a href="https://gdpr-info.eu/" target="_blank" rel="noopener noreferrer">GDPR</a>, <a href="https://www.hhs.gov/hipaa/index.html" target="_blank" rel="noopener noreferrer">HIPAA</a>, <a href="https://oag.ca.gov/privacy/ccpa" target="_blank" rel="noopener noreferrer">CCPA</a>, <a href="https://www.bis.org/bcbs/" target="_blank" rel="noopener noreferrer">BCBS</a> and <a href="https://www.pcisecuritystandards.org/" target="_blank" rel="noopener noreferrer">PCI</a> have instituted requirements for data accuracy and integrity that compel companies and organizations to obtain deeper insight into their datasets and pipelines. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-start-with-the-spark-integration">Why start with the Spark integration?<a href="#why-start-with-the-spark-integration" class="hash-link" aria-label="Direct link to Why start with the Spark integration?" title="Direct link to Why start with the Spark integration?">​</a></h3><p>As Julien and Paweł&#x27;s proposal <a href="https://github.com/OpenLineage/OpenLineage/tree/main/proposals/148" target="_blank" rel="noopener noreferrer">suggests</a>, the Spark integration was a logical starting point for adding column-level lineage. This is so because the integration relies on implementing visitors that traverse a <code>LogicalPlan</code> and extract meaningful information when encountered. These data include outputs and inputs with their schemas (which we were already identifying, in fact). The <code>LogicalPlan</code> also exposes the expressions that derive the output columns from the input columns. They can be inspected to derive column-level lineage. Traversing the <code>LogicalPlan</code> allows for the capturing of all the dependencies required to build column-level lineage.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-new-facet-in-the-spec">A new facet in the spec<a href="#a-new-facet-in-the-spec" class="hash-link" aria-label="Direct link to A new facet in the spec" title="Direct link to A new facet in the spec">​</a></h3><p>In the process of implementing column-level lineage, Paweł and Julien contributed a new facet schema, <code>ColumnLineageDatasetFacet</code>, to the OpenLineage spec. This facet uses fields to relay data points about dependencies. These are properties of items in the <code>InputField</code> property of the facet (<code>namespace</code>, <code>name</code> and <code>field</code>), as well as two human-readable string fields (<code>transformationDescription</code>, <code>transformationType</code>) for conveying information about dataset transformations. The last field, <code>transformationType</code>, may be especially useful for those whose companies or organizations need to track the usage of sensitive personal information.</p><p>An example of a <code>columnLineage</code> facet in the outputs array of a lineage event:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;namespace&quot;: &quot;{namespace of the outputdataset}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;{name of the output dataset}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;facets&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;schema&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;fields&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;name&quot;: &quot;{first column of the output dataset}&quot;, &quot;type&quot;: &quot;{its type}&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;name&quot;: &quot;{second column of the output dataset}&quot;, &quot;type&quot;: &quot;{its type}&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;columnLineage&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;{first column of the output dataset}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;inputFields&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          { &quot;namespace&quot;: &quot;{input dataset namespace}&quot;, name: &quot;{input dataset name}&quot;, &quot;field&quot;: &quot;{input dataset column name}&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ... other inputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;transformationDescription&quot;: &quot;identical&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;transformationType&quot;: &quot;IDENTITY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;{second column of the output dataset}&quot;: ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h3><p>As we’ve seen, column-level lineage is being collected via the new <code>columnLineage</code> dataset facet. For each output, this facet contains a list of the output&#x27;s fields along with the input fields used to create it. The input fields are identified by a <code>namespace</code>, <code>name</code> and <code>field</code>. But how is OpenLineage obtaining the data about dependencies that the facet relays?</p><p>In PR <a href="https://github.com/OpenLineage/OpenLineage/pull/698" target="_blank" rel="noopener noreferrer">#698</a>, Paweł describes the mechanism this way:</p><ol><li>The core mechanism first gets an output schema and logical plan as inputs.</li><li>Then, the <code>OutputFieldsCollector</code> class traverses the plan to gather the outputs. Outputs can be extracted from Aggregate or Project, and each output field has an <code>ExprId</code> (expression ID) that is attached from the plan.</li><li>Next, the <code>InputFieldsCollector</code> class is used to collect inputs that can be extracted from <code>DataSourceV2Relation</code>, <code>DataSourceV2ScanRelation</code>, <code>HiveTableRelation</code> or <code>LogicalRelation</code>. Each input field takes its <code>ExprId</code> from the plan, and each input is identified by a <code>DatasetIdentifier</code>, which means it contains the name and namespace of a dataset and an input field.</li><li>Finally, the <code>FieldDependenciesCollector</code> traverses the plan to identify dependencies between different <code>ExprIds</code>. Dependencies map parent expressions to children expressions. This is used to identify the inputs used to evaluate certain outputs.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What’s next?<a href="#whats-next" class="hash-link" aria-label="Direct link to What’s next?" title="Direct link to What’s next?">​</a></h3><p>Work on extending column-level lineage in the project is ongoing. For example, project committer Will Johnson (<a href="https://github.com/wjohnson" target="_blank" rel="noopener noreferrer">@wjohnson</a>) has opened a PR (<a href="https://github.com/OpenLineage/OpenLineage/issues/963" target="_blank" rel="noopener noreferrer">#963</a>) to add support for common dataframe operations not covered due to the initial focus on Spark. As Will writes in the PR,</p><blockquote><p>Currently, the Column Lineage Input Field Collectors work mainly for Spark SQL operations and Data Source V2.
This leaves out normal dataframe operations like inserting into HDFS without the use of a Hive table.
Column Lineage should support this scenario as many users will want to see column lineage for operations outside of SQL and Hive Metastore backed tables.</p></blockquote><p>Also, Paweł has written enhancements that will <a href="https://github.com/OpenLineage/OpenLineage/issues/993" target="_blank" rel="noopener noreferrer">enable column-level lineage in the case of altered table and column names</a> and <a href="https://github.com/OpenLineage/OpenLineage/issues/738" target="_blank" rel="noopener noreferrer">allow one to extend column-level lineage without contributing to OpenLineage</a> (to avoid exposing proprietary code, for example). </p><p>Meanwhile, over in Marquez, Julien has contributed a <a href="https://github.com/MarquezProject/marquez/issues/2045" target="_blank" rel="noopener noreferrer">proposal</a> to add a column-level endpoint to the project that would leverage OpenLineage’s <code>ColumnLineageDatasetFacet</code>. This approach would add column lineage to an existing endpoint by embedding the <code>columnLineage</code> facet in the data section of the <code>DATASET</code> nodes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-i-contribute">How can I contribute?<a href="#how-can-i-contribute" class="hash-link" aria-label="Direct link to How can I contribute?" title="Direct link to How can I contribute?">​</a></h3><p>We welcome contributions to this ongoing effort at implementing column-level lineage in OpenLineage! If you’re interested in contributing, one of our existing <a href="https://github.com/OpenLineage/OpenLineage/tree/main/integration" target="_blank" rel="noopener noreferrer">integrations</a> might be a good place to start. OpenLineage’s growing list of integrations includes Airflow, dbt, Dagster and Flink.</p><p>Sounds fun? Check out our <a href="https://github.com/OpenLineage/OpenLineage/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">new contributor guide</a> to get started.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/operators-and-extractors-technical-deep-dive"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">How Operators and Extractors Work Under-the-Hook</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/python-client"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">The Python Client -- the Foundation of OpenLineage Integrations</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview--background" class="table-of-contents__link toc-highlight">Overview &amp; background</a></li><li><a href="#why-start-with-the-spark-integration" class="table-of-contents__link toc-highlight">Why start with the Spark integration?</a></li><li><a href="#a-new-facet-in-the-spec" class="table-of-contents__link toc-highlight">A new facet in the spec</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What’s next?</a></li><li><a href="#how-can-i-contribute" class="table-of-contents__link toc-highlight">How can I contribute?</a></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.c8354045.js"></script>
<script src="/assets/js/main.bb3d165b.js"></script>
</body>
</html>