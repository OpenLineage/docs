<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Backfilling Airflow DAGs using Marquez | OpenLineage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Backfilling Airflow DAGs using Marquez | OpenLineage"><meta data-rh="true" name="description" content="In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies."><meta data-rh="true" property="og:description" content="In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-06-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://www.github.com/wslulciuc"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez" hreflang="en"><link data-rh="true" rel="alternate" href="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez" hreflang="x-default"><link rel="alternate" type="application/json" href="/blog/feed.json" title="OpenLineage JSON Feed">






<script src="https://plausible.io/js/script.js" defer="defer" data-domain="openlineage.io"></script>
<script src="js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-QMTWMLMX4M" async></script><link rel="stylesheet" href="/assets/css/styles.083c253c.css">
<link rel="preload" href="/assets/js/runtime~main.04316e5f.js" as="script">
<link rel="preload" href="/assets/js/main.ff302e8a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/resources">Resources</a><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/community">Community</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/survey">Ecosystem Survey 2023</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OpenLineage/openlineage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/london-confluent-meetup">Join us in London on January 31st</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/warsaw-meetup">Meet Us in Warsaw on November 29th!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/metaphor-integration">Metaphor&#x27;s Integration with OpenLineage Enhances Data Governance and Collaboration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/airflow-provider">The OpenLineage Airflow Provider is Here</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/airflow-summit-meetup">Meet Us in Toronto on September 18th!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Backfilling Airflow DAGs using Marquez</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-06-30T00:00:00.000Z" itemprop="datePublished">June 30, 2021</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://www.github.com/wslulciuc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://www.github.com/wslulciuc.png" alt="Willy Lulciuc"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.github.com/wslulciuc" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Willy Lulciuc</span></a></div><small class="avatar__subtitle" itemprop="description">Marquez Project Lead and OpenLineage Committer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies.</p><p>You&#x27;ve just deployed an Airflow <a href="https://airflow.apache.org/docs/apache-airflow/stable/concepts/dags.html#dags" target="_blank" rel="noopener noreferrer">DAG</a> that calculates the total sum of weekly food orders. You were able to identify what input tables to query, the frequency in which your DAG would run, and made sure analysts knew the resulting output table to use in their weekly food order trends report. The DAG only needs to run once a week, and with the DAG managed and scheduled via <a href="https://airflow.apache.org" target="_blank" rel="noopener noreferrer">Airflow</a>, you feel confident that the aggregated food order data will be available every Sunday morning for the weekly report.</p><p>As a developer, you&#x27;re monitoring your DAG for errors and after only a few DAG runs, you&#x27;re alerted that your DAG suddenly started to fail! Before you begin troubleshooting the root cause of the DAG failure, you notify the analytics team that the food order data will be incorrect for the week. After viewing the DAG error logs and a few email exchanges, you eventually discover that an upstream DAG had failed to write food order data for certain daily table partitions. Now, backfilling the missing data can be a manual and tedious task. As you sip your morning coffee, you think to yourself, <em>there must be a better way</em>. Yes, there is and collecting DAG lineage metadata would be a great start.</p><p>In this blog post, we&#x27;ll briefly introduce you to how backfills are handled in Airflow, then discuss how lineage metadata can be used to backfill DAGs with more complex upstream and downstream dependencies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-brief-intro-to-backfilling-airflow-dags">1. Brief Intro to Backfilling Airflow DAGs<a href="#1-brief-intro-to-backfilling-airflow-dags" class="hash-link" aria-label="Direct link to 1. Brief Intro to Backfilling Airflow DAGs" title="Direct link to 1. Brief Intro to Backfilling Airflow DAGs">​</a></h2><p>Airflow supports <a href="https://airflow.apache.org/docs/apache-airflow/stable/dag-run.html#backfill" target="_blank" rel="noopener noreferrer">backfilling</a> DAG runs for a historical time window given a <em>start</em> and <em>end</em> date. Let&#x27;s say our <code>example.etl_orders_7_days</code> DAG started failing on <code>2021-06-06</code>, and we wanted to reprocess the daily table partitions for that week (assuming all partitions have been backfilled upstream). In order to run the backfill for <code>example.etl_orders_7_days</code>, using the Airflow <a href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html" target="_blank" rel="noopener noreferrer">CLI</a>, you open up a terminal and execute the following <code>backfill</code> <a href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html#backfill" target="_blank" rel="noopener noreferrer">command</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Backfill weekly food orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ airflow dags backfill \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --start-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --end-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    example.etl_orders_7_days</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, the backfill was fairly straightforward but they&#x27;re not always trivial. That is, we still have the following open questions: </p><ul><li>How quickly can data quality issues be identified and explored?</li><li>What alerting rules should be in place to notify downstream DAGs of possible upstream processing issues or failures?</li><li>What effects (if any) would upstream DAGs have on downstream DAGs if dataset consumption was delayed?</li></ul><p>Next, we&#x27;ll demonstrate how lineage metadata managed with <a href="https://marquezproject.ai" target="_blank" rel="noopener noreferrer">Marquez</a> can help answer some of these questions (and more!) by maintaining inter-DAG dependencies and cataloging historical runs of DAGs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-exploring-lineage-metadata-using-marquez">2. Exploring Lineage Metadata using Marquez<a href="#2-exploring-lineage-metadata-using-marquez" class="hash-link" aria-label="Direct link to 2. Exploring Lineage Metadata using Marquez" title="Direct link to 2. Exploring Lineage Metadata using Marquez">​</a></h2><blockquote><p><strong>Note:</strong> To seed the Marquez HTTP API server with the sample lineage metadata used in this blog post, see the <a href="https://marquezproject.github.io/marquez/quickstart.html#write-sample-lineage-metadata-to-marquez" target="_blank" rel="noopener noreferrer">Write Sample Lineage Metadata to Marquez</a> section in Marquez&#x27;s <a href="https://marquezproject.github.io/marquez/quickstart.html" target="_blank" rel="noopener noreferrer">quickstart</a> guide.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-collect-dag-lineage-metadata">2.1 COLLECT DAG LINEAGE METADATA<a href="#21-collect-dag-lineage-metadata" class="hash-link" aria-label="Direct link to 2.1 COLLECT DAG LINEAGE METADATA" title="Direct link to 2.1 COLLECT DAG LINEAGE METADATA">​</a></h4><p><img loading="lazy" src="/assets/images/lineage-graph-47b55cf38f6030ddd58cf8b5079506cf.png" width="639" height="501" class="img_ev3q"></p><blockquote><p><strong>Figure 1:</strong> DAG lineage metadata.</p></blockquote><p><a href="https://marquezproject.ai" target="_blank" rel="noopener noreferrer">Marquez</a> is an open source metadata service for the collection, aggregation, and visualization of a data ecosystem’s metadata. Marquez has integration support for Airflow with minimal configuration. Using the <a href="https://github.com/MarquezProject/marquez/tree/main/integrations/airflow" target="_blank" rel="noopener noreferrer"><code>marquez-airflow</code></a> library, DAG lineage metadata will be collected automatically during DAG execution using the <a href="https://openlineage.io" target="_blank" rel="noopener noreferrer">OpenLineage</a> standard, then stored in Marquez’s centralized data model. To learn more about how lineage metadata is stored and versioned in Marquez, see the <a href="https://marquezproject.github.io/marquez/quickstart.html#marquez-data-model" target="_blank" rel="noopener noreferrer">Data Model</a> section in Marquez&#x27;s <a href="https://marquezproject.github.io/marquez/quickstart.html" target="_blank" rel="noopener noreferrer">quickstart</a> guide.</p><p>The Airflow integration gives us two important benefits:</p><ul><li><strong>DAG Metadata:</strong> Each DAG has a code version, inputs and outputs, run args, and run state transitions. Keeping a global historical log of DAG runs linked to code will quickly highlight upstream dependencies errors and minimize downstream impact.</li><li><strong>Lineage Metadata:</strong> Each DAG may have one or more upstream dependency. Keeping track of inter-DAG dependencies will allow for teams within an organization to safely depend on one another’s datasets, while also understanding which DAGs will be impacted downstream of a DAG failure.</li></ul><p>In this blog, we won&#x27;t go into how to enable lineage metadata collection for Airflow DAGs. But, we encourage you to take a look at Marquez&#x27;s Airflow <a href="https://github.com/MarquezProject/marquez/tree/main/examples/airflow" target="_blank" rel="noopener noreferrer">example</a> to learn how to troubleshoot DAG failures using Marquez.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-get-lineage-metadata-via-rest-api">2.2 GET LINEAGE METADATA VIA REST API<a href="#22-get-lineage-metadata-via-rest-api" class="hash-link" aria-label="Direct link to 2.2 GET LINEAGE METADATA VIA REST API" title="Direct link to 2.2 GET LINEAGE METADATA VIA REST API">​</a></h4><p>In Marquez, each dataset and job has its own globally unique node ID that can be used to query the lineage graph. The <a href="https://marquezproject.github.io/marquez/openapi.html#tag/Lineage/paths/~1lineage/get" target="_blank" rel="noopener noreferrer">LineageAPI</a> returns a set of <strong>nodes</strong> consisting of <strong>edges</strong>. An edge is <strong>directed</strong> and has a defined <strong>origin</strong> and <strong>destination</strong>. A lineage graph may contain the following node types: <code>dataset:&lt;namespace&gt;:&lt;dataset&gt;</code>, <code>job:&lt;namespace&gt;:&lt;job&gt;</code>.</p><p>So, let&#x27;s start by querying the lineage graph for our <code>example.etl_orders_7_days</code> DAG using the node ID <code>job:food_delivery:example.etl_orders_7_days</code>. You&#x27;ll notice in the returned lineage graph that the DAG <em>input</em> datasets are <code>public.categories</code>, <code>public.orders</code>, and <code>public.menus</code> with <code>public.orders_7_days</code> as the <em>output</em> dataset:</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="request">REQUEST<a href="#request" class="hash-link" aria-label="Direct link to REQUEST" title="Direct link to REQUEST">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl -X GET &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=job:food_delivery:example.etl_orders_7_days&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="response">RESPONSE<a href="#response" class="hash-link" aria-label="Direct link to RESPONSE" title="Direct link to RESPONSE">​</a></h5><p><code>200 OK</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;graph&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;JOB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;BATCH&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;id&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;namespace&quot;: &quot;food_delivery&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;example.etl_orders_7_days&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;name&quot;: &quot;example.etl_orders_7_days&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;createdAt&quot;: &quot;2021-06-06T14:50:13.931946Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;namespace&quot;: &quot;food_delivery&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;inputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.categories&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menu_items&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menus&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;outputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;context&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;description&quot;: &quot;Loads newly placed orders weekly.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;latestRun&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;id&quot;: &quot;5c7f0dc4-d3c1-4f16-9ac3-dc86c5da37cc&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;createdAt&quot;: &quot;2021-06-06T14:50:36.853459Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;nominalStartTime&quot;: &quot;2021-06-06T14:54:00Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;nominalEndTime&quot;: &quot;2021-06-06T14:57:00Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;state&quot;: &quot;FAILED&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;startedAt&quot;: &quot;2021-06-06T14:54:14.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;endedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;durationMs&quot;: 220000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;args&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;context&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;facets&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;inEdges&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.categories&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.orders&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.menus&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;outEdges&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;, &quot;destination&quot;: &quot;dataset:food_delivery:public.orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }, ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-using-lineage-metadata-to-backfill-airflow-dags">3. Using Lineage Metadata to Backfill Airflow DAGs<a href="#3-using-lineage-metadata-to-backfill-airflow-dags" class="hash-link" aria-label="Direct link to 3. Using Lineage Metadata to Backfill Airflow DAGs" title="Direct link to 3. Using Lineage Metadata to Backfill Airflow DAGs">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-backfilling">3.1 BACKFILLING<a href="#31-backfilling" class="hash-link" aria-label="Direct link to 3.1 BACKFILLING" title="Direct link to 3.1 BACKFILLING">​</a></h4><p><img loading="lazy" src="/assets/images/backfill-d6459ce4e9a65760a7b441987c74b772.png" width="843" height="532" class="img_ev3q"></p><blockquote><p><strong>Figure 2:</strong> Backfilled daily table partitions.</p></blockquote><p>To run a backfill for <code>example.etl_orders_7_days</code> using the DAG lineage metadata stored in Marquez, we&#x27;ll need to query the lineage graph for the upstream DAG where the error originated. Now, let&#x27;s assume the <code>example.etl_orders</code> DAG upstream of <code>example.etl_orders_7_days</code> failed to write some of the daily table partitions needed for the weekly food order trends report (see <strong>Figure 2</strong>). To fix the weekly trends report, we&#x27;ll first need to backfill the missing daily table partitions <code>public.orders_2021_06_04</code>, <code>public.orders_2021_06_05</code>, and <code>public.orders_2021_06_06</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Backfill daily food orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ airflow dags backfill \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --start-date 2021-06-04 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --end-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    example.etl_orders</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/inter-dag-deps-c39c00c0fa8120b6aabdd7fa849bb15d.png" width="958" height="373" class="img_ev3q"></p><blockquote><p><strong>Figure 3:</strong> Airflow inter-DAG dependencies.</p></blockquote><p>Then, using the script <code>backfill.sh</code> defined below, we can easily backfill all DAGs downstream of <code>example.etl_orders</code>:</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="backfillsh"><code>backfill.sh</code><a href="#backfillsh" class="hash-link" aria-label="Direct link to backfillsh" title="Direct link to backfillsh">​</a></h5><blockquote><p><strong>Note:</strong> Make sure you have <a href="https://stedolan.github.io/jq/download" target="_blank" rel="noopener noreferrer"><code>jq</code></a> installed before running <code>backfill.sh</code>. </p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Backfill DAGs automatically using lineage metadata stored in Marquez.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usage: $ ./backfill.sh &lt;start-date&gt; &lt;end-date&gt; &lt;dag-id&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Backfills DAGs downstream of the given node ID, recursively.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">backfill_downstream_of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${1}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Get out edges for node ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">out_edges</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> $lineage_graph </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">    </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> jq -r --arg NODE_ID </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">${node_id}</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;.graph[] | select(.id==$NODE_ID) | .outEdges[].destination&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">out_edge</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${out_edges</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">@</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Run backfill if out edge is a job node (i.e. &lt;dataset&gt; =&gt; &lt;job&gt;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${out_edge}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> job:* </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token assign-left variable" style="color:#36acaa">dag_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${out_edge</span><span class="token string variable operator" style="color:#393A34">##</span><span class="token string variable" style="color:#36acaa">*</span><span class="token string variable operator" style="color:#393A34">:</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;backfilling </span><span class="token string variable" style="color:#36acaa">${dag_id}</span><span class="token string" style="color:#e3116c">...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      airflow backfill --start_date </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${start_date}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> --end_date </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${start_date}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${dag_id}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Follow out edges downstream, recursively</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backfill_downstream_of </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${out_edge}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">start_date</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${1}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">end_date</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${2}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">dag_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${3}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (1) Build job node ID (format: &#x27;job:&lt;namespace&gt;:&lt;job&gt;&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;job:food_delivery:</span><span class="token string variable" style="color:#36acaa">${dag_id}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) Get lineage graph</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">lineage_graph</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">curl</span><span class="token variable" style="color:#36acaa"> -s -X GET </span><span class="token variable string" style="color:#e3116c">&quot;http://localhost:5000/api/v1-beta/lineage?nodeId=</span><span class="token variable string variable" style="color:#36acaa">${node_id}</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Run backfill</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfill_downstream_of </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${node_id}</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you run the script <code>backfill.sh</code>, it will output all backfilled DAGs to the console:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./backfill.sh 2021-06-06 2021-06-06 example.etl_orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.etl_orders_7_days...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.etl_delivery_7_days...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.delivery_times_7_days...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-conclusion">4. Conclusion<a href="#4-conclusion" class="hash-link" aria-label="Direct link to 4. Conclusion" title="Direct link to 4. Conclusion">​</a></h2><p>In this blog post, we showed how easy it can be to automate backfilling DAGs downstream of a data quality issue using lineage metadata stored in Marquez. With only two steps, we were able to backfill missing daily table partitions, then automatically re-run failed DAGs downstream of the upstream DAG where the error originated. But, what measures can we put in place to detect low-quality data issues faster, therefore avoiding backfills altogether? Since Marquez collects DAG run metadata that can be viewed using the <a href="https://marquezproject.github.io/marquez/openapi.html#tag/Jobs/paths/~1jobs~1runs~1%7Bid%7D/get" target="_blank" rel="noopener noreferrer">Runs API</a>, building automated processes that periodically check DAG run states and quickly notifying teams of upstream data quality issue (or missed SLAs) in a timely fashion is just one possible preventive measure.</p><p>We encourge you to explore Marquez&#x27;s opinionated <a href="https://marquezproject.github.io/marquez/openapi.html" target="_blank" rel="noopener noreferrer">Metadata API</a> and define your own automated process(es) for analyzing lineage metadata! If you need help or have any questions, you can always join our <a href="http://bit.ly/MarquezSlack" target="_blank" rel="noopener noreferrer">Slack</a> channel or reach out to us on <a href="https://twitter.com/MarquezProject" target="_blank" rel="noopener noreferrer">Twitter</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/explore-lineage-api"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Exploring Lineage History via the Marquez API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/openlineage-takes-inspiration-from-opentelemetry"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How OpenLineage takes inspiration from OpenTelemetry</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-brief-intro-to-backfilling-airflow-dags" class="table-of-contents__link toc-highlight">1. Brief Intro to Backfilling Airflow DAGs</a></li><li><a href="#2-exploring-lineage-metadata-using-marquez" class="table-of-contents__link toc-highlight">2. Exploring Lineage Metadata using Marquez</a></li><li><a href="#3-using-lineage-metadata-to-backfill-airflow-dags" class="table-of-contents__link toc-highlight">3. Using Lineage Metadata to Backfill Airflow DAGs</a></li><li><a href="#4-conclusion" class="table-of-contents__link toc-highlight">4. Conclusion</a></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.04316e5f.js"></script>
<script src="/assets/js/main.ff302e8a.js"></script>
</body>
</html>