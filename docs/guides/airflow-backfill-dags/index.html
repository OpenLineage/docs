<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/airflow-backfill-dags">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Backfilling Airflow DAGs Using Marquez | OpenLineage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openlineage.io/docs/guides/airflow-backfill-dags"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backfilling Airflow DAGs Using Marquez | OpenLineage"><meta data-rh="true" name="description" content="Adapted from a blog post by Willy Lulciuc"><meta data-rh="true" property="og:description" content="Adapted from a blog post by Willy Lulciuc"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openlineage.io/docs/guides/airflow-backfill-dags"><link data-rh="true" rel="alternate" href="https://openlineage.io/docs/guides/airflow-backfill-dags" hreflang="en"><link data-rh="true" rel="alternate" href="https://openlineage.io/docs/guides/airflow-backfill-dags" hreflang="x-default"><link rel="alternate" type="application/json" href="/blog/feed.json" title="OpenLineage JSON Feed">






<script src="https://plausible.io/js/script.js" defer="defer" data-domain="openlineage.io"></script>
<script src="js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-QMTWMLMX4M" async></script><link rel="stylesheet" href="/assets/css/styles.2f7146bc.css">
<link rel="preload" href="/assets/js/runtime~main.47319d3d.js" as="script">
<link rel="preload" href="/assets/js/main.03a3ae28.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ol-logo.svg" alt="OpenLineage" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/resources">Resources</a><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/survey">Ecosystem Survey 2023</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OpenLineage/openlineage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">About OpenLineage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/spec/object-model">Core Specification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/client/java">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integrations/about">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/guides/about">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/about">About These Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/airflow-quickstart">Getting Started with Airflow and OpenLineage+Marquez</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/spark">Using OpenLineage with Spark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/airflow-backfill-dags">Backfilling Airflow DAGs Using Marquez</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/dbt">Using Marquez with dbt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/facets">Understanding and Using Facets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/airflow_proxy">Using the OpenLineage Proxy with Airflow</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/development/developing/">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/releases/1_8_0">Releases</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Backfilling Airflow DAGs Using Marquez</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Backfilling Airflow DAGs Using Marquez</h1><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adapted-from-a-blog-post-by-willy-lulciuc">Adapted from a <a href="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez/" target="_blank" rel="noopener noreferrer">blog post</a> by Willy Lulciuc<a href="#adapted-from-a-blog-post-by-willy-lulciuc" class="hash-link" aria-label="Direct link to adapted-from-a-blog-post-by-willy-lulciuc" title="Direct link to adapted-from-a-blog-post-by-willy-lulciuc">​</a></h4><p>This tutorial covers the use of lineage metadata in Airflow to backfill DAGs. Thanks to data lineage, backfilling does not have to be a tedious chore.  </p><p>Airflow supports backfilling DAG runs for a historical time window with a given start and end date. If a DAG (<code>example.etl_orders_7_days</code>) started failing on 2021-06-06, for example, you might want to reprocess the daily table partitions for that week (assuming all partitions have been backfilled upstream). This is possible using the <a href="https://openlineage.io/blog/backfilling-airflow-dags-using-marquez/" target="_blank" rel="noopener noreferrer">Airflow CLI</a>. In order to run the backfill for <code>example.etl_orders_7_days</code> using Airflow, create an Airflow instance and execute the following backfill command in a terminal window:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Backfill weekly food orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ airflow dags backfill \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --start-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --end-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    example.etl_orders_7_days</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Unfortunately, backfills are rarely so straightforward. Some questions remain:</p><ul><li>How quickly can data quality issues be identified and explored?</li><li>What alerting rules should be in place to notify downstream DAGs of possible upstream processing issues or failures?</li><li>What effects (if any) would upstream DAGs have on downstream DAGs if dataset consumption were delayed?</li></ul><p>Managing lineage metadata with Marquez clears up much of the ambiguity that has surrounded backfilling. The key is to maintain inter-DAG dependencies and catalog historical runs of DAGs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exploring-lineage-metadata-using-marquez">Exploring Lineage Metadata using Marquez<a href="#exploring-lineage-metadata-using-marquez" class="hash-link" aria-label="Direct link to Exploring Lineage Metadata using Marquez" title="Direct link to Exploring Lineage Metadata using Marquez">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3><ul><li>Sample data (for the dataset used here, follow the instructions in the <a href="https://marquezproject.github.io/marquez/quickstart.html#write-sample-lineage-metadata-to-marquez" target="_blank" rel="noopener noreferrer">Write Sample Lineage Metadata to Marquez</a> section of Marquez&#x27;s <a href="https://marquezproject.github.io/marquez/quickstart.html" target="_blank" rel="noopener noreferrer">quickstart</a> guide)</li><li>Docker 17.05+</li><li>Docker Desktop</li><li>Docker Compose</li><li>jq</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you are using macOS Monterey (macOS 12), port 5000 will have to be released by <a href="https://developer.apple.com/forums/thread/682332" target="_blank" rel="noopener noreferrer">disabling the AirPlay Receiver</a>. Also, port 3000 will need to be free if access to the Marquez web UI is desired.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-the-lineage-graph">Query the Lineage Graph<a href="#query-the-lineage-graph" class="hash-link" aria-label="Direct link to Query the Lineage Graph" title="Direct link to Query the Lineage Graph">​</a></h3><p>After running the seed command in the quickstart guide, check to make sure Marquez is up by visiting http://localhost:3000. The page should display an empty Marquez instance and a message saying there is no data. Also, it should be possible to see the server output from requests in the terminal window where Marquez is running. This window should remain open. As you progress through the tutorial, feel free to experiment with the web UI. Use truncated strings (e.g., &quot;example.etl_orders_7_days&quot; instead of &quot;job:food_delivery:example.etl_orders_7_days&quot;) to find the datasets referenced below.</p><p>In Marquez, each dataset and job has its own globally unique node ID that can be used to query the lineage graph. The LineageAPI returns a set of nodes consisting of edges. An edge is directed and has a defined origin and destination. A lineage graph may contain the following node types: <code>dataset:&lt;namespace&gt;:&lt;dataset&gt;</code>, <code>job:&lt;namespace&gt;:&lt;job&gt;</code>.</p><p>Start by querying the lineage graph of the seed data via the CLI.  The <code>etl_orders_7_days</code> DAG has the node ID <code>job:food_delivery:example.etl_orders_7_days</code>. To see the graph, run the following in a new terminal window: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl -X GET &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=job:food_delivery:example.etl_orders_7_days&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice in the returned lineage graph that the DAG input datasets are <code>public.categories</code>, <code>public.orders</code>, and <code>public.menus</code>, while <code>public.orders_7_days</code> is the output dataset. The response should look something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;graph&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;JOB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;BATCH&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;id&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;namespace&quot;: &quot;food_delivery&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;example.etl_orders_7_days&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;name&quot;: &quot;example.etl_orders_7_days&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;createdAt&quot;: &quot;2021-06-06T14:50:13.931946Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;namespace&quot;: &quot;food_delivery&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;inputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.categories&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menu_items&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menus&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;outputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;context&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;description&quot;: &quot;Loads newly placed orders weekly.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;latestRun&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;id&quot;: &quot;5c7f0dc4-d3c1-4f16-9ac3-dc86c5da37cc&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;createdAt&quot;: &quot;2021-06-06T14:50:36.853459Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;nominalStartTime&quot;: &quot;2021-06-06T14:54:00Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;nominalEndTime&quot;: &quot;2021-06-06T14:57:00Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;state&quot;: &quot;FAILED&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;startedAt&quot;: &quot;2021-06-06T14:54:14.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;endedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;durationMs&quot;: 220000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;args&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;context&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;facets&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;inEdges&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.categories&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.orders&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;dataset:food_delivery:public.menus&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;outEdges&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;origin&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;, &quot;destination&quot;: &quot;dataset:food_delivery:public.orders_7_days&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }, ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To see a visualization of the graph, search the web UI with <code>public.delivery_7_days</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backfill-a-dag-run">Backfill a DAG Run<a href="#backfill-a-dag-run" class="hash-link" aria-label="Direct link to Backfill a DAG Run" title="Direct link to Backfill a DAG Run">​</a></h3><p><img loading="lazy" alt="Backfill" src="data:image/png;base64,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" width="843" height="532" class="img_ev3q"></p><p>Figure 1: Backfilled daily table partitions</p><p>To run a backfill for <code>example.etl_orders_7_days</code> using the DAG lineage metadata stored in Marquez, query the lineage graph for the upstream DAG where an error originated. In this case, the <code>example.etl_orders</code> DAG upstream of <code>example.etl_orders_7_days</code> failed to write some of the daily table partitions needed for the weekly food order trends report. To fix the weekly trends report, backfill the missing daily table partitions <code>public.orders_2021_06_04</code>, <code>public.orders_2021_06_05</code>, and <code>public.orders_2021_06_06</code> using the Airflow CLI:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Backfill daily food orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ airflow dags backfill \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --start-date 2021-06-04 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --end-date 2021-06-06 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    example.etl_orders</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="DAG Deps" src="/assets/images/inter-dag-deps-08d66946b7fa85e1280b3a6bbc3d7b76.png" width="958" height="373" class="img_ev3q"></p><p>Figure 2: Airflow inter-DAG dependencies</p><p>Then, using the script <code>backfill.sh</code> defined below, we can easily backfill all DAGs downstream of <code>example.etl_orders</code>:</p><p>(Note: Make sure you have jq installed before running <code>backfill.sh</code>.)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Backfill DAGs automatically using lineage metadata stored in Marquez.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Usage: $ ./backfill.sh &lt;start-date&gt; &lt;end-date&gt; &lt;dag-id&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Backfills DAGs downstream of the given node ID, recursively.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfill_downstream_of() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_id=&quot;${1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Get out edges for node ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  out_edges=($(echo $lineage_graph \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | jq -r --arg NODE_ID &quot;${node_id}&quot; &#x27;.graph[] | select(.id==$NODE_ID) | .outEdges[].destination&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for out_edge in &quot;${out_edges[@]}&quot;; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Run backfill if out edge is a job node (i.e. &lt;dataset&gt; =&gt; &lt;job&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if [[ &quot;${out_edge}&quot; = job:* ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dag_id=&quot;${out_edge##*:}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      echo &quot;backfilling ${dag_id}...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      airflow backfill --start_date &quot;${start_date}&quot; --end_date &quot;${start_date}&quot; &quot;${dag_id}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Follow out edges downstream, recursively</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backfill_downstream_of &quot;${out_edge}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start_date=&quot;${1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end_date=&quot;${2}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dag_id=&quot;${3}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (1) Build job node ID (format: &#x27;job:&lt;namespace&gt;:&lt;job&gt;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_id=&quot;job:food_delivery:${dag_id}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (2) Get lineage graph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lineage_graph=$(curl -s -X GET &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=${node_id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">​</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (3) Run backfill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfill_downstream_of &quot;${node_id}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When run, the script should output all backfilled DAGs to the console:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./backfill.sh 2021-06-06 2021-06-06 example.etl_orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.etl_orders_7_days...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.etl_delivery_7_days...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backfilling example.delivery_times_7_days...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3><p>The lineage metadata provided by Marquez can make the task of backfilling much easier. But lineage metadata can also help avoid the need to backfill altogether. Since Marquez collects DAG run metadata that can be viewed using the Runs API, building automated processes to check DAG run states and notify teams of upstream data quality issues is just one possible preventive measure.</p><p>Explore Marquez&#x27;s opinionated Metadata API and define your own automated process(es) for analyzing lineage metadata! Also, join our Slack channel or reach out to us on Twitter if you have questions.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/OpenLineage/docs/tree/main/docs/guides/airflow-backfill-dags.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/spark"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using OpenLineage with Spark</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/dbt"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Marquez with dbt</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#exploring-lineage-metadata-using-marquez" class="table-of-contents__link toc-highlight">Exploring Lineage Metadata using Marquez</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#query-the-lineage-graph" class="table-of-contents__link toc-highlight">Query the Lineage Graph</a></li><li><a href="#backfill-a-dag-run" class="table-of-contents__link toc-highlight">Backfill a DAG Run</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.47319d3d.js"></script>
<script src="/assets/js/main.03a3ae28.js"></script>
</body>
</html>